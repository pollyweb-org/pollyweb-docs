@startuml Accept()


' ----------------------
actor "User\nin chat" as user
participant "Wallet ğŸ‘±\napp" as wallet
participant "Notifier ğŸ“£\nbff" as notifier
participant "Broker ğŸ¤µ\ndomain" as broker
participant "Issuer ğŸ´\ndomain" as issuer
participant "Graph ğŸ•¸\ndomain" as graph


activate issuer
    issuer --> wallet: 1) âª Prompt ğŸ¤” {transact?}
deactivate issuer

activate wallet
    user --> wallet: transact
    wallet --> issuer: 
deactivate wallet

activate issuer
    issuer --> broker: 2) Offer ğŸŒ {hook}
deactivate issuer

activate broker
    broker -> graph : 3) Translate ğŸš€ {code}
    
    activate graph
        graph --> broker: {translation}
    deactivate graph

    broker --> wallet: 4) âª Prompt ğŸ¤” {save?}
deactivate broker

activate wallet 
    user --> wallet: save
    wallet --> broker: {Yes}
deactivate wallet

group If user accepted


activate broker
    broker --> notifier: 5) Save ğŸŒ {token}
deactivate broker

' NOTIFY
activate notifier
    notifier --> wallet
deactivate notifier

' ACCEPT
activate wallet
    ' DOWNLOAD
    wallet -> issuer: 6) Issued ğŸš€
    activate issuer
        issuer -> wallet: {token}
    deactivate issuer
    wallet -> wallet: save

    ' CONFIRM
    wallet --> broker: 7) Saved ğŸŒ { token, path }
deactivate wallet

' NOTIFY
activate broker
    broker --> wallet: 8) âª Update Tokens ğŸ«

end group

    broker --> issuer: 9) Accepted {hook, token} ğŸŒ
deactivate broker

activate issuer
    issuer --> wallet: A) âª Prompt ğŸ¤”
deactivate issuer


' ----------------------
@enduml