@startuml OnQueryMatched

box Broker ğŸ¤µ domain #FFFFFA
    participant "Queries ğŸª£" as table
    participant "OnMatched ğŸ””" as handler
end box
participant "Graph ğŸ•¸" as graph

activate table
    table --> handler: MATCHED ğŸ””
deactivate table

activate handler
    
    handler -> handler: PARALLEL {matches}
    activate handler
        handler -> graph: TRUSTS ğŸ«¡ {CONSUMER}
        handler -> graph: TRUSTS ğŸ«¡ {VAULT}
    deactivate handler

    alt has trusts?
        handler -> table: SAVE ğŸ’¾ {TRUSTED}
    else no trusted matches
        handler -> table: SAVE ğŸ’¾ {UNTRUSTED}
    end alt

deactivate handler

@enduml