@startuml OnChatOpened

participant "Wallet ğŸ‘±" as wallet

box Broker ğŸ¤µ domain #FFFFFA
    participant "Opened@ ğŸ“ƒ" as script
    participant "Chats ğŸª£" as chats
    participant "OnOpened ğŸ””" as handler
    participant "Chatters ğŸª£" as chatters
end box

participant "Finder ğŸ”" as finder



wallet --> script: Opened ğŸŒ

activate script
    script -> chats: SAVE ğŸ’¾ {OPENED}
deactivate script

activate chats
    chats --> handler: OPENED ğŸ””
deactivate chats

alt IF Host is Broker

    activate handler
        handler -> chatters: SAVE ğŸ’¾ {POP}

else IF not Broker

    
        handler -> chatters: SAVE ğŸ’¾ {FINDER}
    deactivate handler

    activate chatters
        chatters --> finder: Present ğŸŒ
    deactivate chatters

    activate finder
        finder --> chats: Presented ğŸŒ {PRESENTED} 
    deactivate finder

end alt

@enduml