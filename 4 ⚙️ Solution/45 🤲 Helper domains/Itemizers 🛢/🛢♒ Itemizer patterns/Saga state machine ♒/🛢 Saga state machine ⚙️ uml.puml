@startuml State machine

box sender ğŸ‘¥ domain #FFFFFA
    participant "Script ğŸ“ƒ" as script
    participant "OnState-2 ğŸ””" as event
    participant "Dataset ğŸª£ Key: hook" as table
    participant "Inbox ğŸ“¥" as inbox
end box

box receiver ğŸ‘¥ domain #FFFFFA
    participant "Handler ğŸŒ" as handler
end box


activate script
    script -> table: SAVE ğŸ’¾ {hook, STATE-1}
    script --> handler: SEND ğŸ“¬ {hook}
deactivate script

activate handler
    handler --x inbox: Message ğŸŒ {hook, result}
activate inbox
    inbox -> table: SAVE ğŸ’¾ {hook, result, STATE-2}
deactivate inbox

activate table
    table --> event: Event ğŸ”” {STATE-2}
deactivate table

activate event
    event -> table: SAVE ğŸ’¾ {STATE-3}
deactivate event


    handler --> inbox: Message ğŸŒ {hook, result}
deactivate handler

activate inbox
    inbox -> table: SAVE ğŸ’¾ {hook, result, STATE-2}
deactivate inbox

activate table
    table -> table: Ignored, out of state order âŒ
deactivate table

@enduml