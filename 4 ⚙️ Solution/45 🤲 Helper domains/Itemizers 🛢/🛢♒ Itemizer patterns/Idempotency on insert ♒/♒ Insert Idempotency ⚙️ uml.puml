@startuml Idempotency

box sender ğŸ‘¥ domain #FFFFFA
    participant "Script ğŸ“ƒ" as script
end box

box receiver ğŸ‘¥ domain #FFFFFA
    participant "Handler ğŸŒ" as handler
    participant "Dataset ğŸª£ Key: hook, sender" as table
    participant "OnInserted ğŸ””" as event
end box


activate script
    script -> script: .UUID >> hook
    script --x handler: SEND ğŸ“¬ {hook}
    
activate handler
    handler -> table: SAVE ğŸ’¾ {hook, sender}
deactivate handler

activate table
    table --> event: Event ğŸ”” {INSERTED}
deactivate table

    script --> handler: SEND ğŸ“¬ {hook}
deactivate script

activate handler
    handler -> table: SAVE ğŸ’¾ {hook, sender}
deactivate handler


activate table
    table -> table: Ignore duplicate key âŒ 
deactivate table


@enduml