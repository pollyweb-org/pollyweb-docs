@startuml CHAT
' TODO

participant  "Broker ðŸ¤µ" as broker
box Host ðŸ¤— domain #FFFFFA
    participant "Script ðŸ“ƒ" as script
    participant "CHAT ðŸ’¬" as CHAT
    participant "$.Chat ðŸ§ " as holder
    participant "Chats ðŸª£" as chats
end box


broker --> script: {chat}

activate script
    script -> CHAT: CHAT ðŸ’¬ {chat, broker}
deactivate script

activate CHAT

    group Return if $.Chat.Exists
        CHAT -> holder: IF $.Chat.Exists 
        CHAT -> script: RETURN 
    end group

    group Return if Host.Chats exists
        CHAT -> chats: READ ðŸ§² {broker, chat}
        CHAT -> holder: SET $.Chat
        CHAT -> script: RETURN 
    end group

    CHAT -> chats: SAVE ðŸ’¾ {chat, broker}
activate chats
    CHAT -> CHAT: WAIT ðŸ§˜ {chat.ID}
deactivate CHAT

    chats --> CHAT: RACE ðŸ
deactivate chats

activate CHAT
    CHAT -> script: RETURN
deactivate CHAT

activate script
deactivate script

@enduml 
