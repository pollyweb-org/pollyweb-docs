@startuml OnQueryReceived

box Consumer ğŸ’¼ domain #FFFFFA
    participant "Queries ğŸª£" as table
    participant "OnReceived ğŸ””" as handler
end box
participant "Graph ğŸ•¸" as graph

table --> handler: RECEIVED ğŸ”” 

activate handler
    handler -x table: unexpected schema âŒ 
    handler -> graph: VERIFY ğŸ” {token}
    handler -x table: invalid token âŒ 
    handler -x table: issuer not trusted âŒ 
    handler -x table: broker state not active âŒ 
    handler -> table: SAVE ğŸ’¾ TOKENED âœ…
    
    
deactivate handler


@enduml 