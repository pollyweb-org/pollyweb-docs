@startuml SHARE
 
box Consumer ðŸ’¼ domain #FFFFFA
    participant "Script ðŸ“ƒ" as script
    participant "SHARE âŒ˜" as talker
    participant "Queries ðŸª£" as table
end box

participant "Broker ðŸ¤µ" as broker
participant "Wallet ðŸ‘±" as wallet
participant "Vault ðŸ—„ï¸" as vault
participant "Identity ðŸ†”" as identity

activate script
    script -> talker: SHARE ðŸ’¼ {schemas}
deactivate script

activate talker
    talker -> table: SAVE ðŸ’¾ {schemas}
deactivate talker

activate table
    table --> broker: Query ðŸŒ 
activate broker
    table -> talker
deactivate table

activate talker
    talker -> talker: WAIT 
deactivate talker

    broker --> vault: 
    activate vault

    broker --> wallet: 
deactivate broker
activate wallet

    wallet --> table: Receive ðŸŒ {token}
deactivate wallet
activate table

    vault --> table: Consume ðŸŒ {bind}    
deactivate vault

    table -> identity: IDENTIFY ðŸ†” (if it is an identity-bound token)

    table -> talker: RACE ðŸ {schema, data}
deactivate table

activate talker
    talker -> script: RETURN {schema, data}
deactivate talker

activate script
deactivate script

@enduml 
