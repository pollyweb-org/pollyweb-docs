@startuml Accept()


' ----------------------
actor "User\nin chat" as user
participant "Wallet ğŸ‘±\napp" as wallet
participant "Notifier ğŸ“£\nbff" as notifier
participant "Broker ğŸ¤µ\nhost" as broker
participant "Issuer ğŸ´\ndomain" as issuer

' ISSUE
activate issuer
    issuer --> broker: 1) offer@
deactivate issuer

' REGISTER
activate broker
    broker --> wallet: 2) âª prompt 
deactivate broker

activate wallet
    user --> wallet: save
    wallet --> broker: {Yes}
deactivate wallet

activate broker
    broker --> notifier: 3) offer@
deactivate broker

' NOTIFY
activate notifier
    notifier --> wallet
deactivate notifier

' ACCEPT
activate wallet
    ' DOWNLOAD
    wallet -> issuer: 4) token@
    activate issuer
        issuer -> wallet: {token}
    deactivate issuer
    wallet -> wallet: persist

    ' CONFIRM
    wallet --> broker: 5) accepted@ { path }
deactivate wallet

' NOTIFY
activate broker
    broker --> wallet: 6) âª update tokens 
    broker --> issuer: 7) accepted@
deactivate broker

activate issuer
    issuer --> wallet: 8) âª prompt 
deactivate issuer


' ----------------------
@enduml