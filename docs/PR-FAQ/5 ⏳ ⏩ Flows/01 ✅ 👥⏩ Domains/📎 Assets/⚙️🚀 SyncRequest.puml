
@startuml Sync Request
' ----------------------

box Sender Domain #FFFFFF
  participant "Sender\nLogic ğŸ§ " as dom1
  participant "Sender\nOutbox ğŸš€" as srv1
  participant "Sender\nDNS ğŸŒ" as dns1
end box

box Receiver Domain #FFFFFF
  participant "Receiver\nDNS ğŸŒ" as dns2
  participant "Receiver\nInbox ğŸ“¨" as api2
  participant "Receiver\nLogic ğŸ§ " as dom2
end box

  
activate dom1

  dom1 -> dom1: new ID
  dom1 -> srv1: {msg}

  activate srv1

    srv1 -> srv1: sign
    srv1 -> api2: {msg}

    activate api2 

        api2 -> dns1: public key? 
        activate dns1
          dns1 -> api2: {public key}
        deactivate dns1
        
        api2 x--> srv1: HTTP 401 if invalid signature
        api2 x--> srv1: HTTP 422 if invalid schema
        api2 x--> srv1: HTTP 200 if duplicate ID
        api2 -> dom2: {msg}

        activate dom2
          dom2 -> api2: {reply}
        deactivate dom2

        api2 -> api2: store ID
        api2 -> srv1: {reply} HTTP 200

    deactivate api2

    srv1 -> dom1: {reply} 
  deactivate srv1

deactivate dom1


' ----------------------
@enduml